"use strict";class HeartSlider{constructor(t){this.reset(t)}reset(t){var e,s=this;for(var i in s.settings={buttons:!1,clickToAdvance:!1,delay:1e3,effect:"fadeOut",loop:!0,manualTransition:400,paused:!1,pauseOnInactiveWindow:!1,progressive:!0,randomize:!1,slideshow:".heart-slideshow",slides:".heart-slide",swipe:!0,transition:3e3,progressIndicators:{enable:!1,type:"dash",clickable:!0,color:"#fff"}},t)if(this.settings.hasOwnProperty(i))if("object"==typeof t[i]&&"slideshow"!==i){t[i].enable=!0;for(const a in t[i]){const l=t[i][a];this.settings[i].hasOwnProperty(a)&&(this.settings[i][a]=l)}}else this.settings[i]=t[i];if(this.slideshowSelector="object"==typeof s.settings.slideshow?s.settings.slideshow:document.querySelector(s.settings.slideshow),!this.slideshowSelector)return!1;if(this.slideshowSelector.classList.contains("first-image-loaded"))return console.warn("HeartSlider will not re-init if the first-image-loaded class is already present."),this.destroy(),!1;if(this.slideshowSelector.classList.contains("heart-slideshow")||this.slideshowSelector.classList.add("heart-slideshow"),this.slides=Array.prototype.slice.apply(this.slideshowSelector.querySelectorAll(this.settings.slides)),0===this.slides.length){const d=this.slideshowSelector.children;this.slides=[...d].filter(t=>"BUTTON"!==t.tagName)}if(this.total=this.slides.length,this.index=0,this.manualTimeout,this.originallyPaused=this.settings.paused,this.settings.randomize&&(this.index=Math.floor(Math.random()*this.total)),this.settings.progressive&&this.progressiveLoad(this.index,!0,this),"fadeInOut"===this.settings.effect&&this.slideshowSelector.classList.add("fade-in-out"),this.firstIndex=this.index,this.slides.forEach(function(t,e){e!==s.firstIndex&&(t.setAttribute("aria-hidden","true"),t.setAttribute("tab-index","-1")),t.classList.contains("heart-slide")||t.classList.add("heart-slide"),s.settings.swipe&&t.setAttribute("draggable","true")}),this.goToSlide(this.firstIndex,!1,!0),this.slides.length<2)return!1;(s.settings.progressive||(s.kickstartProgressiveTimer=setTimeout(()=>{s.slideshowSelector.classList.add("progressive-loading-disabled"),s.kickstart()},100)),this.initVis=function(){return s.heartVisibilityHandler(s)},s.settings.pauseOnInactiveWindow&&document.addEventListener("visibilitychange",this.initVis,!0),s.settings.swipe&&(s.slideshowSelector.addEventListener("touchstart",s.swipeHandler(s).handleTouchStart,{passive:!0}),s.slideshowSelector.addEventListener("touchmove",s.swipeHandler(s).handleTouchMove,{passive:!0})),s.settings.clickToAdvance)&&s.slideshowSelector.addEventListener("click",function(t){e||"BUTTON"===t.target.nodeName||(s.pause(),s.next(s,!0,!1,!0),e=setTimeout(()=>{e=void 0},s.settings.manualTransition),s.originallyPaused||(s.throttleClickResume&&clearTimeout(s.throttleClickResume),s.throttleClickResume=setTimeout(()=>{s.resume()},s.settings.transition+1.25*s.settings.delay)))},!1);if(this.settings.progressIndicators&&this.settings.progressIndicators.enable){const c=this.slideshowSelector.querySelector(".progress-container")?this.slideshowSelector.querySelector(".progress-container"):document.createElement("div");c.classList.add("progress-container");const u=this.settings.progressIndicators.type||"dash";c.classList.add("type-"+u);const h=this.settings.progressIndicators.color||"#fff";"#fff"===h&&"#ffffff"===h&&"white"===h&&"rgb(255, 255, 255)"===h&&"rgba(255, 255, 255, 1)"===h||c.style.setProperty("--indicator-color",h);const g=this.settings.progressIndicators.clickable?"button":"div";c.style.setProperty("--total",this.total),c.childElementCount>0&&(c.innerHTML="");for(let m=0;m<this.total;m++){const f=document.createElement(g);f.classList.add("indicator"),f.setAttribute("data-index",m),f.addEventListener("click",t=>{if(m===this.index)return;s.pause();s.goToSlide(m,!0,!1,!0),e=setTimeout(()=>{e=void 0},s.settings.manualTransition),s.originallyPaused||(s.throttleClickResume&&clearTimeout(s.throttleClickResume),s.throttleClickResume=setTimeout(()=>{s.resume()},s.settings.transition+1*s.settings.delay))}),c.appendChild(f)}this.slideshowSelector.appendChild(c),this.progressContainerSelector=c,this.progressIndicators=c.querySelectorAll(".indicator"),window.requestAnimationFrame(()=>{this.progressIndicators[this.firstIndex].classList.add("active","first")})}const o=s.slideshowSelector.querySelectorAll("button[class*='heart-']");if(s.settings.buttons||2===o.length){function p(t){e||(s.pause(),t.classList.contains("heart-next")?s.next(s,!0,!1,!0):t.classList.contains("heart-prev")&&s.previous(s,!0,!1,!0),e=setTimeout(()=>{e=void 0},200))}if(0===o.length){const v=["heart-prev","heart-next"];for(var n=0;n<v.length;n++){var r=document.createElement("button");r.classList.add(v[n]),r.setAttribute("aria-label",v[n].replace("heart-","")),r.setAttribute("tab-index","0"),r.addEventListener("click",function(t){p(t.currentTarget)},!1),s.slideshowSelector.appendChild(r)}}else for(const y of o){y.setAttribute("tab-index","0");const S=y.classList.contains("heart-prev")?"prev":"next";y.setAttribute("aria-label",S),y.addEventListener("click",function(t){p(t.currentTarget)},!1)}}}kickstart(){const t=this;if(t.settings.progressive){t.slideshowSelector.classList.add("first-image-loaded");window.requestAnimationFrame(function(){t.firstImageLoad&&t.firstImageLoad(t),t.kickstartProgressiveLoadTimer=setTimeout(()=>{t.progressiveLoad((t.firstIndex+1+t.total)%t.total)},t.settings.delay)})}t.settings.paused||(t.kickoffTimer=setTimeout(()=>{t.resume(),t.kickoffTimer=void 0},.5*t.settings.delay+t.settings.transition))}on(t,e){const s=this,i=["transitionStart","transitionEnd","firstImageLoad"];if(i.includes(t))if("function"==typeof e){function o(s){let i=new CustomEvent(t,{detail:{slideshow:s}});s.slideshowSelector.dispatchEvent(i),e(i.detail.slideshow,i.detail.slideshow.slideshowSelector,i.detail.slideshow.currentSlide)}"transitionStart"===t&&(s.transitionStart=function(t){o(t)}),"transitionEnd"===t&&(s.transitionEnd=function(t){o(t)}),"firstImageLoad"===t&&(s.firstImageLoad=function(t){o(t)})}else s.settings.debug&&console.warn("Your second argument for "+t+" must be a function.");else s.settings.debug&&console.warn('"'+t+'" is not a valid event. Try one of these:',i)}swipeHandler(t){function e(t){return t.touches||t.originalEvent.touches}return this.xDown=null,this.yDown=null,{getTouches:e,handleTouchStart:function(t){const s=e(t)[0];this.xDown=s.clientX,this.yDown=s.clientY},handleTouchMove:function(e){if(this.xDown&&this.yDown){var s=e.touches[0].clientX,i=e.touches[0].clientY,o=this.xDown-s,n=this.yDown-i;Math.abs(o)>Math.abs(n)&&(o>0?(e.preventDefault(),t.pause(),t.next(t,!0,!1,!0)):(e.preventDefault(),t.pause(),t.previous(t,!0,!1,!0))),this.xDown=null,this.yDown=null}}}}heartVisibilityHandler(t=this){let e=t.currentSlide,s=t.previousSlide;if(t.currentSlideProgress=t.currentSlideProgress||0,null!==t&&t.settings.pauseOnInactiveWindow&&null!==t.settings.slideshow)if("hidden"==document.visibilityState){t.settings.debug&&console.log("%cWindow Lost Focus. HeartSlider is Paused.","font-style: italic; font-size: 0.9em; color: #757575; padding: 0.2em;"),t.pause();let i=window.getComputedStyle(e).opacity;t.currentSlideProgress=1-i,t.currentSlideProgress>0&&(e.style.opacity=t.currentSlideProgress,s.style.opacity=1)}else if(t.settings.debug&&console.log("%cRegained Focus. Resumed HeartSlider.","font-style: italic; font-size: 0.9em; color: #6F9F67; padding: 0.2em;"),t.currentSlideProgress>0&&(e.style.transitionDuration=t.settings.transition*t.currentSlideProgress+"ms",e.style.transitionTimingFunction="ease-out"),e.style.opacity="",s.style.opacity="",!t.originallyPaused){t.visResumeTimer&&clearTimeout(t.visResumeTimer);const s=t.settings.transition*t.currentSlideProgress+t.settings.delay;t.visResumeTimer=setTimeout(()=>{e.style.transitionDuration="0ms",e.style.transitionTimingFunction="",t.resume()},s)}}goToSlide(t,e=!1,s=!1,i=!1){if("number"!=typeof t&&(t=Number(t)),this.transitioning&&!i)return!1;if(!this.settings.loop&&!s&&t===this.firstIndex)return this.pause(),!1;this.transitioning=!0,this.slides[t]&&this.slides[t].querySelector("video")&&this.clearAllTimers();var o=this;this.previousSlide=this.slides[this.index];var n=(t+this.total)%this.total;this.currentSlide=this.slides[n];const r=this.progressContainerSelector,a=this.progressIndicators;if(void 0!==r&&a.length>0){const t=a[n],e=r.querySelectorAll(".active");for(const t of e)t.classList.remove("active","first");t.classList.add("active")}var l=e||s||i?o.settings.manualTransition:o.settings.transition;this.index=n,s||this.progressiveLoad(n),this.progressiveLoad((n+1+o.total)%o.total),window.requestAnimationFrame(function(){let t=1;const e=o.previousSlide;if(e===o.currentSlide&&i){clearTimeout(o.manualTimeout),clearInterval(o.slideInterval);const r=window.getComputedStyle(e).opacity;t=1-r,e.style.opacity=r,e.style.transition="none",window.requestAnimationFrame(()=>{e.style.transition="opacity",e.style.transitionDelay="0ms",e.style.transitionDuration=l*t+"ms",e.style.opacity=""})}else e!==o.currentSlide&&("fadeInOut"===o.settings.effect?(e.style.transitionDelay="0ms",e.style.transitionDuration=l/2+"ms"):(e.style.transitionDelay=l+"ms",e.style.transitionDuration="0ms"),e.classList.remove("active"));const n=o.currentSlide.querySelector("video");if(null!==n){function a(t){const e=o.settings.delay+2*o.settings.transition,s=Math.max(1e3*t.duration-e,0);s>=0&&(o.pause(),o.videoSlideTimer&&clearTimeout(o.videoSlideTimer),o.videoSlideTimer=setTimeout(()=>{o.originallyPaused||o.resume()},s+o.settings.transition))}n.currentTime=0,n.play(),n.duration&&"number"==typeof n.duration?a(n):n.onloadedmetadata=function(){a(n)}}if("fadeInOut"===o.settings.effect?(o.currentSlide.style.transitionDelay=l/3+"ms",o.currentSlide.style.transitionDuration=l/2+"ms"):(o.currentSlide.style.transitionDelay="0ms",o.currentSlide.style.transitionDuration=l+"ms"),o.slideshowSelector.querySelectorAll(".heart-slide.active").length>1){o.settings.debug&&console.warn("HeartSlider detected multiple active slides. Fixing...");for(const d of o.slides)d.classList.contains("active")&&d!==o.currentSlide&&(d.classList.remove("active"),d.style.transitionDelay="0ms",d.style.transitionDuration="0ms");o.settings.debug&&console.log("Fixed!")}o.currentSlide.removeAttribute("aria-hidden"),o.currentSlide.removeAttribute("tab-index"),o.currentSlide.classList.add("active"),o.transitionEndTimer&&clearTimeout(o.transitionEndTimer),o.transitionStart&&o.transitionStart(o),o.transitionEndTimer=setTimeout(()=>{if(e.style.transitionDelay="0ms",e.style.transitionDuration="0ms",!s){e.setAttribute("aria-hidden","true"),e.setAttribute("tab-index","-1"),o.transitionEnd&&o.transitionEnd(o);const t=e.querySelector("video");null!==t&&(t.pause(),t.currentTime=0)}o.transitioning=!1,o.transitionEndTimer=void 0},l*t)})}progressiveLoad(t,e=!1,s=this){const i=this.slides[t];if(null!==i){var o=Array.prototype.slice.call(i.querySelectorAll("img"));if(o&&o.length>0){function r(t,i){t.classList.add("heart-loaded"),t.classList.remove("heart-loading"),e&&0==i&&s.kickstart()}o.forEach((t,e)=>{if(null!=t&&!t.classList.contains("heart-loaded")&&!t.classList.contains("heart-loading")&&null!==t.currentSrc)if(t.classList.add("heart-loading"),t.complete&&t.naturalWidth>0)r(t,e);else{t.onload=r(t,e);["sizes","srcset","src"].forEach(function(e){var s=t.getAttribute("data-"+e);s&&null==t.getAttribute(e)&&(t.setAttribute(e,s),t.setAttribute("data-"+e,""))})}})}var n=Array.prototype.slice.call(i.querySelectorAll("video"));n&&n.length>0&&n.forEach((i,o)=>{if(null!=i&&!i.classList.contains("heart-loaded")&&!i.classList.contains("heart-loading")){i.muted="muted";function n(){if(i.classList.add("heart-loaded"),i.classList.remove("heart-loading"),e&&0==o&&s.kickstart(),!1===s.settings.randomize||"all"!==s.settings.randomize){const t=Array.from(s.slideshowSelector.querySelectorAll("video")),e=t.indexOf(i);if(e===t.length-1)return null;const o=t[e+1].closest(".heart-slide");if(null!==o){const t=Array.from(s.slides).indexOf(o);s.progressiveLoad(t)}}}if(["playsinline","disablepictureinpicture","disableremoteplayback","preload"].forEach(t=>{if(!i.getAttribute(t)){let e="";"preload"===t&&(e="auto"),i.setAttribute(t,e)}}),i.onloadstart=()=>{i.classList.add("heart-loading")},i.oncanplaythrough=n.bind(i),""==i.src&&null!==i.getAttribute("data-src")&&(i.src=i.getAttribute("data-src"),i.removeAttribute("data-src")),i.querySelectorAll("source").length>0){const r=i.querySelectorAll("source");let a=0;for(const l of r)""==l.src&&null!==l.getAttribute("data-src")&&(l.src=l.getAttribute("data-src"),l.removeAttribute("data-src")),l.onerror=()=>{a++,this.removeEmptySlideAndReinit(t,a,r.length)}}i.load()}})}}removeEmptySlideAndReinit(t,e,s){const i=this.slides[t];e===s&&(this.slideshowSelector.removeChild(i),console.warn("removed slide based on error loading source:",i),this.reset(this.settings),0===t&&(this.slideshowSelector.classList.add("first-image-loaded"),_this.firstImageLoad&&_this.firstImageLoad(_this)))}prevNextHandler(t,e,s){const i=this;if(!0!==i.transitioning)!0===s&&i.progressiveLoad(e),i.goToSlide(t,s,!1,o),setTimeout(function(){i.transitioning=!1},s?i.settings.manualTransition:i.settings.transition);else if(!0===s){i.manualTimeout&&clearTimeout(i.manualTimeout),i.originallyPaused||(i.manualTimeout=setTimeout(i.resume(),i.settings.transition+i.settings.delay)),i.progressiveLoad(e);var o=!0;let t=!1;return void i.goToSlide(i.index,s,t,o)}}clearAllTimers(){clearInterval(this.slideInterval),clearTimeout(this.progressiveLoadTimer),clearTimeout(this.kickstartProgressiveTimer),clearTimeout(this.kickstartProgressiveLoadTimer),clearTimeout(this.manualTimeout),clearTimeout(this.kickoffTimer),clearTimeout(this.throttleClickResume),clearTimeout(this.videoSlideTimer),clearTimeout(this.visResumeTimer)}destroy=function(){this.clearAllTimers(),document.removeEventListener("visibilitychange",this.initVis,!0),void 0!==this.slides&&this.slides.forEach(function(t,e){t.classList.remove("active"),t.removeAttribute("style"),t.removeAttribute("aria-hidden"),t.removeAttribute("tab-index"),t.removeAttribute("draggable");const s=t.querySelectorAll("img");for(const t of s){["sizes","srcset","src"].forEach(e=>{null!==t.getAttribute(e)&&(t.setAttribute("data-"+e,t.getAttribute(e)),t.removeAttribute(e)),t.classList.remove("heart-loaded")})}const i=t.querySelectorAll("video");for(const t of i)null!==t&&(t.classList.remove("heart-loaded"),t.pause())});const t=this.slideshowSelector.querySelectorAll("button[class*='heart-']");if(t.length)for(const e of t)e.remove();const e=this.slideshowSelector.querySelector(".progress-container");null!==e&&e.remove(),this.slideshowSelector.classList.remove("fade-in-out"),this.slideshowSelector.classList.remove("first-image-loaded");const s=Object.getOwnPropertyNames(this);for(const t of s)this.hasOwnProperty(t),delete this[`${t}`];setTimeout(()=>{const t=["utterly and completely annihilated.","obliterated.","demolished beyond recognition.","reduced to atoms.","wiped out.","devastated.","razed to the ground.","utterly decimated.","torn asunder.","completely wrecked.","destroyed.","FUBAR'd."],e=Math.floor(Math.random()*t.length);_this.settings.debug&&console.warn("%cSuccess! HeartSlider has been "+t[e],"font-size: 1.2em; font-weight: bold"),setTimeout(()=>{const t=["What did I ever do to you?","How could you??","I'm disappointed in your actions and expect better from you.","Your behavior was unacceptable, and it's important to address it.","I'm upset by what you did, and I hope we can resolve this issue.","Your actions have consequences, and you need to take responsibility.","I can't condone what you did, and I hope you'll make amends.","What you did was wrong, and it's essential to make it right.","Death. Death at last.","I'm concerned about the intention of your actions.","It's important to acknowledge your mistakes and work on improving.","Was I not good enough?","I'm willing to forgive, but you need to show genuine remorse.","I'm hurt by what you did, and I hope we can rebuild.","I hope you make better choices in the future.","Sheesh... That one felt personal.","I believe in second chances. Please don't let me go.","I'm disappointed in you.","Your actions have consequences.","Ouch!","We all make mistakes.","Let the hate flow through you."],e=Math.floor(Math.random()*t.length);_this.settings.debug&&console.warn("%c"+t[e],"font-size: 1em; font-weight: bold")},1500)},100)};goTo=function(t){_this.settings.debug&&console.log(t+1<=this.total),t+1<=this.total?(this.pause(),this.goToSlide(t)):_this.settings.debug&&console.warn("Attempting to go to a slide that does not exist.","Slide requested: "+t+" of "+this.total)};next=function(t=this,e=!1){var s=(t.index+1+t.total)%t.total,i=(s+1+t.total)%t.total;t.prevNextHandler(s,i,e)};previous=function(t=this,e=!1){var s=(t.index-1+t.total)%t.total,i=s;t.prevNextHandler(s,i,e)};resume=function(t=this){t.settings.paused&&(t.settings.paused=!1);var e=(t.index+1+t.total)%t.total;t.settings.progressive&&(t.progressiveLoadTimer=setTimeout(()=>{t.progressiveLoad((e+1+t.total)%t.total)},t.settings.delay)),t.goToSlide(e),this.slideInterval=setInterval(function(){t.next(t,!1)},t.settings.delay+t.settings.transition)};pause=function(t=this){t.settings.paused||(t.settings.paused=!0,this.clearAllTimers())}}export{HeartSlider}
